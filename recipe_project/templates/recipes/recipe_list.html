{% extends 'base.html' %}

{% block title %}–í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã{% endblock %}

{% block content %}
<h1>–í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã</h1>

<form method="get" class="search-form">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤..." value="{{ search_query|default_if_none:'' }}">
    <button type="submit">üîç</button>
</form>

<div class="filter-categories">
    <a href="{% url 'recipe_list' %}" class="{% if not request.GET.category and not request.GET.q %}active{% endif %}">–í—Å–µ</a>
    {% for category in categories %}
    <a href="?category={{ category.id }}{% if search_query %}&q={{ search_query }}{% endif %}"
       class="{% if category.id|stringformat:'s' == request.GET.category %}active{% endif %}">
        {{ category.name }}
    </a>
    {% endfor %}
</div>

<div class="recipe-grid">
    {% for recipe in recipes %}
    <div class="recipe-card">
        <a href="{% url 'recipe_detail' recipe.id %}" class="recipe-link">
            {% if recipe.image %}
            <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
            {% endif %}
            <div class="recipe-card-content">
                <h3>{{ recipe.title }}</h3>
                <p>{{ recipe.description|truncatewords:20 }}</p>
                <div class="recipe-meta">
                    <small>–ê–≤—Ç–æ—Ä: {{ recipe.author.username }}</small>
                    <small>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ recipe.created_at|date:"d.m.Y" }}</small>
                </div>
            </div>
        </a>
    </div>
    {% empty %}
    <p>–†–µ—Ü–µ–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
    {% endfor %}
</div>

<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}">¬´ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <span class="current">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}">–°–ª–µ–¥—É—é—â–∞—è ¬ª</a>
    {% endif %}
</div>
{% endblock %}
