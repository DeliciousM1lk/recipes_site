{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å {{ user.username }}{% endblock %}

{% block content %}
    <div class="profile-layout">
        <div class="profile-card">
            {% if user.avatar %}
                <img src="{{ user.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" class="profile-avatar">
            {% else %}
                <img src="{% static 'images/default_avatar.png' %}" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" class="profile-avatar">
            {% endif %}
            <div class="profile-info">
                <h2>{{ user.username }}</h2>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {% if user.is_active %}–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω üéâ{% else %}–ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω üö®{% endif %}</p>
                <p><small>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {{ user.date_joined|date:"d.m.Y" }}</small></p>
            </div>
        </div>

        <div>
            {% if user.unconfirmed_email %}
            <div class="message-alert info unconfirmed-email-alert">
                <p>
                    –í—ã –∑–∞–ø—Ä–æ—Å–∏–ª–∏ —Å–º–µ–Ω—É Email –Ω–∞ <strong>{{ user.unconfirmed_email }}</strong>.
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å.
                    <a href="{% url 'resend_email_change_email' %}" class="resend-link">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ.</a>
                </p>
            </div>
            {% endif %}

            <section class="profile-edit-section">
                <h2 class="section-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏ Email</h2>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    <p>–¢–µ–∫—É—â–∏–π Email: <strong>{{ user.email }}</strong></p>

                    <div class="form-group">
                        {{ profile_form.new_email.label_tag }}
                        {{ profile_form.new_email }}
                        {{ profile_form.new_email.errors }}
                        <small>–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Email –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.</small>
                    </div>

                    <div class="form-group">
                        {{ profile_form.avatar.label_tag }}
                        {% if user.avatar %}<p>–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª: <a href="{{ user.avatar.url }}" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a></p>{% endif %}
                        {{ profile_form.avatar }}
                        {{ profile_form.avatar.errors }}
                    </div>

                    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>

                    <p class="change-password-link"><a href="{% url 'password_change' %}">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</a></p>
                </form>
            </section>

            <section class="profile-recipes" style="margin-top: 30px;">
                <h2 class="section-title">–í–∞—à–∏ —Ä–µ—Ü–µ–ø—Ç—ã</h2>
                <ul class="recipe-list-small">
                    {% for recipe in user_recipes %}
                        <li>
                            <a href="{% url 'recipe_detail' recipe.pk %}">{{ recipe.title }}</a>

                            <span class="recipe-status status-{{ recipe.status }}">
                                {% if recipe.status == 'approved' %}
                                    ‚úÖ –û–¥–æ–±—Ä–µ–Ω
                                {% elif recipe.status == 'pending' %}
                                    ‚è≥ –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
                                {% elif recipe.status == 'rejected' %}
                                    ‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω
                                {% elif recipe.status == 'draft' %}
                                    ‚úèÔ∏è –ß–µ—Ä–Ω–æ–≤–∏–∫
                                {% endif %}
                            </span>

                            {% if recipe.status == 'rejected' and recipe.moderator_comment %}
                                <div class="moderator-message">
                                    <strong>–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞:</strong> {{ recipe.moderator_comment|truncatechars:100 }}
                                    {% if recipe.moderator_comment|length > 100 %}
                                        <a href="{% url 'recipe_detail' recipe.pk %}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                                    {% endif %}
                                </div>
                            {% endif %}

                            <small class="recipe-date">({{ recipe.created_at|date:"d.m.Y" }})</small>
                        </li>
                    {% empty %}
                        <li>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤. <a href="{% url 'recipe_add' %}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</a></li>
                    {% endfor %}
                </ul>
            </section>
        </div>
    </div>
{% endblock %}